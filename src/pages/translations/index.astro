---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const allWorks = await getCollection('works');
const byAuthor = new Map();
for (const entry of allWorks) {
  const author = entry.data.author;
  if (!byAuthor.has(author)) byAuthor.set(author, []);
  byAuthor.get(author).push(entry.data);
}
// Sort authors: Baha'u'llah first, then The Bab, Abdu'l-Baha, Shoghi Effendi
const authorOrder = ["Baha'u'llah", "The Bab", "Abdu'l-Baha", "Shoghi Effendi"];
const sortedAuthors = [...byAuthor.keys()].sort(
  (a, b) => (authorOrder.indexOf(a) === -1 ? 99 : authorOrder.indexOf(a)) - (authorOrder.indexOf(b) === -1 ? 99 : authorOrder.indexOf(b))
);
---

<Base
  title="Translations"
  description={"Browse 188 sacred tablets and writings from Bah치'u'll치h, the B치b, and 'Abdu'l-Bah치 in the CTAI corpus."}
>
  <h1 class="text-3xl font-semibold text-ink-100 mb-2">Translations</h1>
  <p class="text-ink-400 mb-8">
    {allWorks.length} sacred texts in Arabic and Persian, with source links and metadata.
  </p>

  {sortedAuthors.map(author => {
    const works = byAuthor.get(author).sort((a, b) => a.title.localeCompare(b.title));
    const slug = works[0].author_slug;
    return (
      <section class="mb-10">
        <h2 class="text-xl font-semibold text-ink-200 mb-1">
          <a href={`/translations/${slug}/`} class="hover:text-gold-400 transition-colors">{author}</a>
        </h2>
        <p class="text-sm text-ink-500 mb-4">{works.length} works</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          {works.map(w => (
            <a href={`/translations/${w.author_slug}/${w.doc_id}/`}
               class="block p-4 bg-ink-800/40 rounded-lg border border-ink-700/40 hover:border-gold-500/30 transition-colors">
              <div class="font-semibold text-ink-100 text-sm mb-1">{w.title}</div>
              {w.title_original && (
                <div class="font-arabic text-ink-400 text-sm" dir="rtl">{w.title_original}</div>
              )}
              <div class="flex items-center gap-2 mt-2">
                <span class="text-[10px] uppercase tracking-wider text-ink-500 bg-ink-700 px-1.5 py-0.5 rounded">{w.language}</span>
                {w.se_translation && (
                  <span class="text-[10px] uppercase tracking-wider text-gold-400 bg-gold-400/10 px-1.5 py-0.5 rounded">SE Translation</span>
                )}
                {w.has_english_translation && (
                  <span class="text-[10px] uppercase tracking-wider text-emerald-400 bg-emerald-400/10 px-1.5 py-0.5 rounded">English</span>
                )}
              </div>
            </a>
          ))}
        </div>
      </section>
    );
  })}
</Base>
